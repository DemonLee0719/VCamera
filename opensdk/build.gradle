plugins {
    id 'com.android.library'
}

android {
    compileSdk rootProject.ext.compileSdkVersion

    defaultConfig {
        minSdk rootProject.ext.minSdkVersion
        targetSdk rootProject.ext.targetSdkVersion
        versionCode rootProject.ext.versionCode
        versionName rootProject.ext.versionName

        consumerProguardFiles "consumer-rules.pro"
        buildConfigField "boolean", "localTest", "${rootProject.ext.localTest}"
        buildConfigField "boolean", "isMasterPkg", "${rootProject.ext.isMasterPkg}"

        buildConfigField "String", "ENGINE_JAR_NAME", "\"${rootProject.ext.hackJarName}\""

        if (!rootProject.ext.isMasterPkg) {
            manifestPlaceholders = [masterPkg: "${rootProject.ext.masterPkg}"]
        }

    }

    sourceSets {
        main {
            java.srcDirs = ['src', "${projectDir}/build/src/main/java"]

            if (rootProject.ext.isMasterPkg) {
                manifest.srcFile 'src/main/AndroidManifest.xml'
            } else {
                manifest.srcFile 'src/main/AndroidManifest_assist.xml'
            }
        }
    }

    buildTypes {
        release {
            minifyEnabled false
            proguardFiles getDefaultProguardFile('proguard-android-optimize.txt'), 'proguard-rules.pro'
        }
    }

    compileOptions {
        sourceCompatibility rootProject.ext.javaVersion
        targetCompatibility rootProject.ext.javaVersion
    }

    afterEvaluate {
        task generateConstantJavaFile(type: Exec) {
            File source = new File("${projectDir}/resources/java/com/hack/opensdk/CmdConstants.java")
            File destDir = new File("${projectDir}/build/src/main/java/com/hack/opensdk")
            destDir.mkdirs()
            copy {
                from source
                into destDir
            }
        }

        generateConstantJavaFile
    }
}
